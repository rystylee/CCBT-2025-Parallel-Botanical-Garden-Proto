# タスクリスト

## 概要
CCBT-2025-Parallel-Botanical-Garden-Proto v2.0の開発タスク管理

**最終更新**: 2026-02-06

---

## 1. 完了済み機能 ✅

### 1.1 コア実装
- [x] モジュール分離（app/, bi/ディレクトリ）
- [x] BIControllerクラス（4段階サイクル処理）
- [x] AppControllerクラス（OSCサーバー管理）
- [x] BIInputDataモデル
- [x] Soft Prefix生成ユーティリティ

### 1.2 OSCエンドポイント
- [x] `/bi/input` - 入力データ受付
- [x] `/bi/start` - サイクル開始
- [x] `/bi/stop` - サイクル停止
- [x] `/bi/status` - ステータス取得

### 1.3 設定ファイル
- [x] デバイスタイプ設定（1st_BI / 2nd_BI）
- [x] サイクル設定（receive_duration, rest_duration, max_data_age）
- [x] ターゲットデバイスリスト
- [x] OSC受信ポート設定
- [x] LLM/TTS設定

### 1.4 データ処理
- [x] タイムスタンプフィルタリング
- [x] デバイスタイプ別フィルタリング
- [x] 時系列順データ連結
- [x] 入力バッファ管理

### 1.5 ドキュメント
- [x] 要件定義書の更新
- [x] 実装計画書の更新
- [x] タスクリストの更新

---

## 2. 進行中のタスク 🔄

現在進行中のタスクはありません。

---

## 3. 優先度: 最高 🔴🔴

### 3.0 タイムスタンプ管理の修正
**目的**: 正しいタイムスタンプ管理の実装

#### 3.0.1 フィルタリング処理の修正
- [x] `add_input()`メソッドでのタイムスタンプチェック実装
  - データ受信時に即座に古いデータを破棄
  - デバイスタイプ別フィルタリング（2nd_BIは人間入力を拒否）
- [x] `_receiving_phase()`から`_filter_old_data()`呼び出しを削除
- [x] `_filter_old_data()`メソッドの削除または非推奨化

**実装場所**: `bi/controller.py`

#### 3.0.2 タイムスタンプ伝播の修正
- [x] `_output_phase()`でのタイムスタンプ生成を修正
  - 新規タイムスタンプ発行を削除
  - バッファ内の最新のタイムスタンプを取得して使用（`max()`関数）
- [x] 空バッファ時のエラーハンドリング追加

**実装場所**: `bi/controller.py`

#### 3.0.3 動作検証
- [ ] 単体テストでタイムスタンプフィルタリングを確認
- [ ] 複数デバイス間でのタイムスタンプ伝播を確認
- [ ] 複数入力時のタイムスタンプ選択を検証

**実装場所**: `tests/test_timestamp.py`（新規作成）

---

## 4. 優先度: 高 🔴

### 4.1 テストスクリプト実装
**目的**: 各機能の動作確認

#### 4.1.1 単体テスト
- [ ] BIController各フェーズのテスト
  - `_receiving_phase()` の動作確認
  - `_generating_phase()` の動作確認
  - `_output_phase()` の動作確認
  - `_resting_phase()` の動作確認
- [ ] データフィルタリングのテスト
  - タイムスタンプフィルタリング
  - デバイスタイプ別フィルタリング（2nd_BI）
- [ ] データ連結のテスト
  - 時系列順ソート確認
  - 複数入力の連結確認

**実装場所**: `tests/test_bi_controller.py`（新規作成）

#### 4.1.2 統合テスト
- [ ] 1st BI → 2nd BI のデータフロー確認
- [ ] 複数デバイス間の通信テスト
- [ ] サイクルの無限ループ動作確認
- [ ] エラーハンドリングのテスト

**実装場所**: `tests/test_integration.py`（新規作成）

### 4.2 パフォーマンス測定
- [ ] サイクル時間の測定
  - 各フェーズの実行時間
  - サイクル全体の時間
- [ ] LLM推論速度の測定
- [ ] TTS生成・再生速度の測定
- [ ] メモリ使用量の監視

**実装場所**: `tests/test_performance.py`（新規作成）

---

## 5. 優先度: 中 🟡

### 5.1 ドキュメント整備
- [ ] README更新
  - v2.0の機能説明
  - セットアップガイド
  - 使用方法とサンプルコード
  - トラブルシューティング
- [ ] 設定ファイルサンプル作成
  - `config/config.1st_bi.example.json`
  - `config/config.2nd_bi.example.json`
  - `config/config.multi_device.example.json`

### 5.2 エラーハンドリング強化
- [ ] StackFlow接続エラー時の詳細ログ
- [ ] OSC送信失敗時のリトライ機構
- [ ] 異常データ受信時の処理

### 5.3 ロギング改善
- [ ] ログレベルの最適化
- [ ] ログファイル出力対応（オプション）
- [ ] 重要イベントのログ強調

---

## 6. 優先度: 低 🟢

### 6.1 可視化ツール
- [ ] サイクル状態の可視化ダッシュボード
- [ ] 入力バッファの内容表示
- [ ] ネットワークトポロジー図の生成

**実装場所**: `tools/visualizer.py`（新規作成）

### 6.2 Excelトポロジー設定
- [ ] Excelファイルからのトポロジー読み込み
- [ ] pandasライブラリの追加
- [ ] Excelテンプレートの作成

**実装場所**: `api/topology.py`（新規作成）

### 6.3 動的設定変更
- [ ] `/bi/set_targets` エンドポイント実装
- [ ] ランタイムでの送信先変更機能
- [ ] 設定変更のバリデーション

### 6.4 パフォーマンス最適化
- [ ] LLM推論の最適化
- [ ] メモリ使用量の削減
- [ ] 非同期処理の最適化
- [ ] プロファイリングツールの導入

---

## 7. 今後の拡張案 💡

### 7.1 機能拡張
- [ ] HTTP APIサポート
- [ ] WebSocketによるリアルタイム通信
- [ ] 生成テキスト履歴の保存
- [ ] 音声ファイルのエクスポート機能

### 7.2 モデル拡張
- [ ] より大きなLLMモデル対応（1.5B, 3B等）
- [ ] カスタムファインチューニングモデル対応
- [ ] 複数モデルの同時実行

### 7.3 インターフェース拡張
- [ ] GUI管理画面
- [ ] Webブラウザからのコントロール
- [ ] MIDI CC対応

---

## 8. 完了基準

各タスクは以下の基準を満たした場合に完了とみなします：

1. **実装完了**: コードが動作し、基本的なテストが通る
2. **コードレビュー**: セルフレビュー済み
3. **ドキュメント更新**: 関連ドキュメントが更新されている
4. **コミット**: Gitにコミットされている（Conventional Commits形式）

---

## 9. 進捗サマリー

### 実装状況
- **コア機能**: ✅ 100% 完了（タイムスタンプ管理の修正完了）
- **テスト**: ⏳ 0% 完了
- **ドキュメント**: ✅ 95% 完了（タスクリスト更新済み）
- **拡張機能**: ⏳ 0% 完了

### タスク統計
- **完了済み**: 28個
- **進行中**: 0個
- **未着手（最高優先度）**: 0個
- **未着手（高優先度）**: 8個
- **未着手（中優先度）**: 7個
- **未着手（低優先度）**: 8個

---

## 10. 次のアクション

### 最優先タスク
1. **タイムスタンプ動作の検証テスト作成** ← 次に実施すべき
   - 単体テストでタイムスタンプフィルタリングを確認
   - 複数デバイス間でのタイムスタンプ伝播を検証
   - 複数入力時のタイムスタンプ選択を検証
2. BIController各フェーズの単体テスト実装
3. 複数デバイス間での統合テスト実装

### 推奨アクション
- タイムスタンプ動作検証テストを作成
- BIControllerの各フェーズの単体テストを実装
- 複数デバイス環境での統合テストを実施

---

## 11. 変更履歴

| 日付 | 変更内容 |
|------|---------|
| 2026-02-06 | タイムスタンプ管理の修正完了、タスクリスト更新 |
| 2026-02-06 | タイムスタンプ管理の修正タスクを最優先として追加 |
| 2026-02-06 | 実装状況に合わせてタスクリストを全面更新 |
| 2025-02-06 | v2.0向けにタスクリストを作成 |

---

## 12. 参考リンク

- [要件定義書](requirements.md)
- [実装計画書](plan.md)
- [README.md](../README.md)
- [CLAUDE.md](../CLAUDE.md)

---

**このタスクリストは実装の進捗に応じて随時更新されます。**
